{"version":3,"sources":["../src/limedocs-wiki-converter.js"],"names":[],"mappings":"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","file":"limedocs-wiki-converter.js","sourcesContent":["\"use strict\"\n\nvar Promise = require(\"bluebird\")\n  , fs = require('fs-extra')\n  , path = require('path')\n  , defaults = require('defaults')\n  , GWCMarkdown = require('./markdown')\n  , GWCHtmlWriter = require('./html-writer')\n  , GWCPdfWriter = require('./pdf-writer')\n  , GWCToc = require('./toc')\n  , GWCFinder = require('./finder')\n  , helpers = require('./helpers')\n  , logger = require('./logger')\n\nclass LimedocsWikiConverter {\n  /**\n   * GWC Constructor\n   *\n   * @param {string} wiki_path wiki path\n   * @param {object} options options object\n   * @constructor\n   */\n  constructor(wiki_path, options) {\n\n    if (!wiki_path || fs.statSync(wiki_path).isDirectory() === false) {\n      throw new TypeError('wiki_path is not a valid directory.')\n    }\n\n    this.wikiPath = wiki_path\n    this.markdownConverter = new GWCMarkdown(this.wikiPath)\n\n    this.computePaths()\n        .computeOptions(options)\n        .computeCssFiles()\n        .computeJsFiles()\n        .checkTocLevel()\n        .checkOutputFormat()\n  }\n\n  generate() {\n\n    var self = this\n\n    return new Promise(function(resolve, reject) {\n\n      GWCFinder.searchMarkdownFiles(self.wikiPath).then(function (result) {\n\n        this.mdFiles = result.files\n        this.mdAliases = result.aliases\n        this.toc = new GWCToc(self)\n\n        this.copyAssets()\n\n        var promises = []\n\n        if(this.getOption('format').indexOf('html') >= 0) {\n          this.htmlWriter = new GWCHtmlWriter(this)\n          promises.push(this.htmlWriter.write())\n        }\n\n        if(this.getOption('format').indexOf('pdf') >= 0) {\n          this.pdfWriter = new GWCPdfWriter(this)\n          promises.push(this.pdfWriter.write())\n        }\n\n        return Promise.all(promises).then(resolve).catch(reject)\n\n      }.bind(this))\n    }.bind(this))\n  }\n\n  /**\n   * @private\n   * @returns {LimedocsWikiConverter}\n   */\n  computePages() {\n    this.pages = []\n    this.toc.getItems().forEach(item => {\n      let link = helpers.getPageIdFromFilenameOrLink(item.link)\n      if (this.mdAliases[link]) {\n        this.pages.push({\n          title: item.title,\n          file: this.mdAliases[link],\n          html: this.markdownConverter.convertMarkdownFile(this.mdAliases[link])\n        })\n      }\n    }, this)\n    return this\n  }\n\n  getPages() {\n    if (!this.pages) {\n      this.computePages()\n    }\n    return this.pages\n  }\n\n  getMarkdownConverter() {\n    return this.markdownConverter\n  }\n\n  getMarkdownFiles() {\n    return this.mdFiles\n  }\n\n  getToc() {\n    return this.toc\n  }\n\n  /**\n   * @private\n   * @returns {LimedocsWikiConverter}\n   */\n  computePaths() {\n    this.assetsPath = path.resolve(path.join(__dirname, '..', 'assets'))\n    this.cssPath = path.join(this.assetsPath, 'css')\n    this.imagesPath = path.join(this.assetsPath, 'images')\n    this.htmlPath = path.join(this.assetsPath, 'html')\n    return this\n  }\n\n  /**\n   * @private\n   * @returns {LimedocsWikiConverter}\n   */\n  computeCssFiles() {\n\n    this.cssFiles = [\n      path.join(__dirname, '..', 'node_modules', 'bootstrap', 'dist', 'css', 'bootstrap.min.css'),\n      path.join(__dirname, '..', 'node_modules', 'highlight.js', 'styles', 'default.css'),\n      path.join(__dirname, '..', 'node_modules', 'highlight.js', 'styles', this.options.highlightTheme + '.css'),\n      path.join(this.cssPath, 'doc.css')\n    ]\n\n    this.options.userCssFile && this.cssFiles.push(path.resolve(this.options.userCssFile))\n    return this\n  }\n\n  /**\n   * @private\n   * @returns {LimedocsWikiConverter}\n   */\n  computeJsFiles() {\n\n    this.jsFiles = [\n      path.join(__dirname, '..', 'node_modules', 'jquery', 'dist', 'jquery.min.js'),\n      path.join(__dirname, '..', 'node_modules', 'bootstrap', 'dist', 'js', 'bootstrap.min.js')\n    ]\n\n    this.options.userJsFile && this.jsFiles.push(path.resolve(this.options.userJsFile))\n    return this\n  }\n\n  copyAssets() {\n    if (!this.getOption('disableInlineAssets')) {\n      return\n    }\n    var assetsFiles = this.getJsFiles().concat(this.getCssFiles())\n\n    assetsFiles.forEach(function(file) {\n      fs.copySync(file, path.join(this.getOption('output'), path.basename(file)))\n    }, this)\n  }\n\n  computeOptions(options) {\n\n    var def = {\n      title : 'Documentation',\n      format : 'html',\n      filename : 'documentation',\n      output : path.resolve('./'),\n      tocFile : GWCFinder.searchForFile(['_Toc.html', '_Sidebar.html', '_Toc.md', '_Sidebar.md'], this.wikiPath),\n      tocLevel : 3, // between 1 and 4\n      highlightTheme : 'darkula',\n      userCssFile : null\n    }\n\n    this.options = defaults(options, def)\n\n    if (this.options.verbose) {\n      logger.transports.console.level = 'debug'\n    }\n\n    logger.debug(\"gwc launched with options\", this.options)\n\n    return this\n  }\n\n  /**\n   * Transform the format string into an array containing one to two elements\n   *\n   * @returns {string[]}\n   */\n  checkOutputFormat() {\n    if (this.options.format === 'all') {\n      return (this.options.format = ['html', 'pdf'])\n    }\n    this.options.format = [this.options.format]\n    return this\n  }\n\n  checkTocLevel() {\n    this.options.tocLevel = parseInt(this.options.tocLevel, 10)\n    if (this.options.tocLevel < 1 || this.options.tocLevel > 4) {\n      this.options.tocLevel = 3\n    }\n    return this\n  }\n\n  setOption(key, value) {\n    this.options[key] = value\n    return this\n  }\n\n  getOption(key) {\n    return this.options[key]\n  }\n\n  getTocFile() {\n    return this.getOption('tocFile')\n  }\n\n  addCssFile(file) {\n    this.cssFiles.push(path.resolve(file))\n    return this\n  }\n\n  getCssFiles() {\n    return this.cssFiles\n  }\n\n  getJsFiles() {\n    return this.jsFiles\n  }\n}\n\nObject.defineProperty(LimedocsWikiConverter, 'package', {\n  value : require('../package')\n})\n\nmodule.exports = LimedocsWikiConverter\n"]}